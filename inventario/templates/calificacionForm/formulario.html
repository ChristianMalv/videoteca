<form enctype="multipart/form-data" method="post">
  {% csrf_token %}
  {% for field in formulario %}
  <div class="mb-3">
    {% if field.name == 'axo_produccion' %}
      <label for="{{ field.id_for_label }}" class="form-label">Año de producción</label>
      <input type="text" name="{{ field.name }}" value="{{ field.value|default_if_none:'' }}" class="form-control" placeholder="Año de producción">
    {% else %}
      <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
    {% endif %}
    {{ field.errors }}
    {% if field.name == 'fecha_calificacion' %}
      <input type="date" name="{{ field.name }}" value="{{ field.value|default_if_none:'' }}" class="form-control" placeholder="{{ field.label }}">
    {% elif field.name == 'observaciones' %}
      <textarea name="{{ field.name }}" class="form-control" placeholder="{{ field.label }}">{{ field.value|default_if_none:'' }}</textarea>
    {% else %}
      {% if field.name != 'axo_produccion' and field.field.widget.input_type != 'hidden' %}
        <input type="{{ field.field.widget.input_type }}" name="{{ field.name }}" value="{{ field.value|default_if_none:'' }}" class="form-control" placeholder="{{ field.label }}">
      {% endif %}
    {% endif %}
  </div>
  {% endfor %}
    
  <div class="d-flex justify-content-center">
    <div>
      <a name="" id="atrasBtn" class="btn btn-danger" href="#" role="button">
          <div style="display: flex; flex-direction: column; align-items: center;">
            <i class='fas fa-hand-point-left mt-1'></i>
              <span>Atrás</span>
          </div>
      </a>

      <button name="" id="siguienteBtn" class="btn btn-siguiente btn-sm active" style="background-color:#b38e5d;" type="submit" role="button">
        <div style="display: flex; flex-direction: column; align-items: center;">
          <i class='fas fa-hand-point-right mt-1'></i>
          <span>Siguiente</span>
        </div>
      </button>
      
      <button name="" id="revicionForm" class="btn btn-success" href="#" role="button">  
        <div style="display: flex; flex-direction: column; align-items: center;">
          <i class="fas fa-save mt-1"></i> 
          <span>Guardar para revisión</span>
        </div>
      </button> 

      <button name="" id="aceptaForm" class="btn btn-primary" href="#" role="button">  
        <div style="display: flex; flex-direction: column; align-items: center;">
          <i class='fas fa-check-circle mt-1'></i>
          <span>Revisado y Aceptado</span>
        </div>
      </button> 

    </div>
  </div>
</form>

<script>
 // Lógica de navegación entre pestañas utilizando JavaScript

siguienteBtn.addEventListener('click', function() {
  // Redirige a la URL correspondiente a la siguiente vista
  if (window.location.href.includes('{% url "datosGenerales" %}')) {
    window.location.href = '{% url "descripcion" %}';
  } else if (window.location.href.includes('{% url "descripcion" %}')) {
    window.location.href = '{% url "mapa" %}';
  } else if (window.location.href.includes('{% url "mapa" %}')) {
    window.location.href = '{% url "realizacion" %}';
  } else if (window.location.href.includes('{% url "realizacion" %}')) {
    window.location.href = '{% url "tecnicas" %}';
  }
});

atrasBtn.addEventListener('click', function() {
  // Redirige a la URL correspondiente a la vista anterior
  if (window.location.href.includes('{% url "descripcion" %}')) {
    window.location.href = '{% url "datosGenerales" %}';
  } else if (window.location.href.includes('{% url "mapa" %}')) {
    window.location.href = '{% url "descripcion" %}';
  } else if (window.location.href.includes('{% url "realizacion" %}')) {
    window.location.href = '{% url "mapa" %}';
  } else if (window.location.href.includes('{% url "tecnicas" %}')) {
    window.location.href = '{% url "realizacion" %}';
  }
});

// Ocultar botones según la URL actual
if (window.location.href.includes('{% url "datosGenerales" %}')) {
  atrasBtn.style.display = 'none';  // Oculta el botón de "Atrás"
  revicionForm.style.display = 'none';  // Oculta el botón de "Guardar Formulario"
  aceptaForm.style.display = 'none';   
} else if (window.location.href.includes('{% url "descripcion" %}')) {
  revicionForm.style.display = 'none';
  aceptaForm.style.display = 'none';
} else if (window.location.href.includes('{% url "mapa" %}')) {
  revicionForm.style.display = 'none';
  aceptaForm.style.display = 'none';
} else if (window.location.href.includes('{% url "realizacion" %}')) {
  revicionForm.style.display = 'none';
  aceptaForm.style.display = 'none';
} else if (window.location.href.includes('{% url "tecnicas" %}')) {
  siguienteBtn.style.display = 'none';
}

$("#revicionForm").click(function(event) {
  event.preventDefault(); // Evitar el envío de formulario por defecto

  let $button = $(this); // Guardamos una referencia al botón actual
  Swal.fire({
    title: '¿Deseas guardar este formulario?',
    text: 'No podrás revertir esta acción.',
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#28a745',
    cancelButtonColor: '#d33',
    confirmButtonText: 'Sí, continuar'
  }).then((result) => {
    if (result.isConfirmed) {
      // Obtener los datos del formulario
      let formData = $('form').serialize();
      
      // Realizar la petición AJAX para guardar los datos
      $.ajax({
        url: '{% url "tecnicas" %}',
        type: 'POST',
        data: formData,
        success: function(response) {
          Swal.fire(
            'Registrado',
            'Su formulario ha sido registrado y se encuentra en calificación.',
            'success'
          )
          atrasBtn.style.display = 'none';  // Oculta el botón de "Atrás"
          $button.hide(); // Oculta el botón utilizando la referencia guardada
        },
        error: function(xhr, ajaxOptions, thrownError) {
          // Manejar el error de la petición AJAX si es necesario
          console.log(xhr.status);
          console.log(thrownError);
        }
      });
    }
  });
});

$("#aceptaForm").click(function(event) {
  event.preventDefault(); // Evitar el envío de formulario por defecto

  let $button = $(this); // Guardamos una referencia al botón actual
  Swal.fire({
    title: '¿Deseas guardar este formulario?',
    text: 'No podrás revertir esta acción.',
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#28a745',
    cancelButtonColor: '#d33',
    confirmButtonText: 'Sí, continuar'
  }).then((result) => {
    if (result.isConfirmed) {
      // Obtener los datos del formulario
      let formData = $('form').serialize();
      console.log(`Datos del formulario: ${formData}`)
    }
  });
});

  //if(field.name == 'observaciones' == ''){
  //  console.log(1)
  //}

</script>
