<form enctype="multipart/form-data" method="post">
  {% csrf_token %}
{% for field in formulario %}
<div class="mb-3">
    <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
    {{ field.errors }}
    {% if field.name == 'fecha_calificacion' %}
        <input type="date" name="{{ field.name }}" value="{{ field.value|default_if_none:'' }}" class="form-control" placeholder="{{ field.label }}">
    {% elif field.name == 'observaciones' %}
        <textarea name="{{ field.name }}" class="form-control" placeholder="{{ field.label }}">{{ field.value|default_if_none:'' }}</textarea>
    {% else %}
        {% if field.field.widget.input_type != 'hidden' %}
        <input type="{{ field.field.widget.input_type }}" name="{{ field.name }}" value="{{ field.value|default_if_none:'' }}" class="form-control" placeholder="{{ field.label }}">
        {% endif %}
    {% endif %}
</div>
{% endfor %}
    
  <div class="d-flex justify-content-between">
    <div>
      <a name="" id="atrasBtn" class="btn btn-danger" href="#" role="button">
          <div style="display: flex; flex-direction: column; align-items: center;">
              <span>Atrás</span>
              <i class='fas fa-hand-point-left'></i>
          </div>
      </a>

      <button name="" id="siguienteBtn" class="btn btn-success" type="submit" role="button">
        <div style="display: flex; flex-direction: column; align-items: center;">
          <span>Siguiente</span>
          <i class='fas fa-hand-point-right'></i>
        </div>
      </button>
      

      <button name="" id="guardarForm" class="btn btn-success" href="#" role="button">  
        <div style="display: flex; flex-direction: column; align-items: center;">
          <span>Guardar Formulario</span>
          <i class="fas fa-save"></i>
        </div>
      </button> 
    </div>

    {% comment %} <div>
        <a name="" id="" class="btn btn-primary" href="{% url 'prestamos_list' %}" role="button">
            <div style="display: flex; flex-direction: column; align-items: center;">
                <span>Regresar a Prestamos</span>
                <i class="fas fa-backspace"></i>
            </div>
        </a>
    </div> {% endcomment %}
  </div>
</form>

<script>
 // Lógica de navegación entre pestañas utilizando JavaScript

siguienteBtn.addEventListener('click', function() {
  // Redirige a la URL correspondiente a la siguiente vista
  if (window.location.href.includes('{% url "datosGenerales" %}')) {
    window.location.href = '{% url "descripcion" %}';
  } else if (window.location.href.includes('{% url "descripcion" %}')) {
    window.location.href = '{% url "mapa" %}';
  } else if (window.location.href.includes('{% url "mapa" %}')) {
    window.location.href = '{% url "realizacion" %}';
  } else if (window.location.href.includes('{% url "realizacion" %}')) {
    window.location.href = '{% url "tecnicas" %}';
  }
});

atrasBtn.addEventListener('click', function() {
  // Redirige a la URL correspondiente a la vista anterior
  if (window.location.href.includes('{% url "descripcion" %}')) {
    window.location.href = '{% url "datosGenerales" %}';
  } else if (window.location.href.includes('{% url "mapa" %}')) {
    window.location.href = '{% url "descripcion" %}';
  } else if (window.location.href.includes('{% url "realizacion" %}')) {
    window.location.href = '{% url "mapa" %}';
  } else if (window.location.href.includes('{% url "tecnicas" %}')) {
    window.location.href = '{% url "realizacion" %}';
  }
});

// Ocultar botones según la URL actual
if (window.location.href.includes('{% url "datosGenerales" %}')) {
  atrasBtn.style.display = 'none';  // Oculta el botón de "Atrás"
  guardarForm.style.display = 'none';  // Oculta el botón de "Guardar Formulario"
} else if (window.location.href.includes('{% url "descripcion" %}')) {
  guardarForm.style.display = 'none';
} else if (window.location.href.includes('{% url "mapa" %}')) {
  guardarForm.style.display = 'none';
} else if (window.location.href.includes('{% url "realizacion" %}')) {
  guardarForm.style.display = 'none';
} else if (window.location.href.includes('{% url "tecnicas" %}')) {
  siguienteBtn.style.display = 'none';
}

$("#guardarForm").click(function(event) {
  event.preventDefault(); // Evitar el envío de formulario por defecto

  let $button = $(this); // Guardamos una referencia al botón actual
  Swal.fire({
    title: '¿Deseas guardar este formulario?',
    text: 'No podrás revertir esta acción.',
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#28a745',
    cancelButtonColor: '#d33',
    confirmButtonText: 'Sí, continuar'
  }).then((result) => {
    if (result.isConfirmed) {
      // Obtener los datos del formulario
      let formData = $('form').serialize();
      
      // Realizar la petición AJAX para guardar los datos
      $.ajax({
        url: '{% url "tecnicas" %}',
        type: 'POST',
        data: formData,
        success: function(response) {
          Swal.fire(
            'Registrado',
            'Su formulario ha sido registrado y se encuentra en calificación.',
            'success'
          )
          atrasBtn.style.display = 'none';  // Oculta el botón de "Atrás"
          $button.hide(); // Oculta el botón utilizando la referencia guardada
        },
        error: function(xhr, ajaxOptions, thrownError) {
          // Manejar el error de la petición AJAX si es necesario
          console.log(xhr.status);
          console.log(thrownError);
        }
      });
    }
  });
});


</script>
